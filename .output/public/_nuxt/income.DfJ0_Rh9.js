import{_ as O,r as n,o as B,c as p,g as o,e as R,t as i,z as m,f as b,E as A,F as Q,D as j,b as f}from"./entry.C9akT-V3.js";import{_ as F}from"./Input.DF6DQD6P.js";import{_ as H}from"./Button.NMpH9qMp.js";import{a as h,b as v}from"./api.CikITYnx.js";import{QrcodeStream as J}from"./vue-qrcode-reader.C_Plo8ti.js";import"./Icon.BfqRHdzy.js";const M={class:"mb-6 flex items-center gap-3"},T={class:"uppercase text-xs font-semibold text-gray-400"},Y={class:"flex items-center gap-3 mt-6"},$={key:0},q={style:{"z-index":"100",top:"50%",left:"50%",color:"#fff","font-size":"30px",position:"fixed",transform:"translate(-50%,-50%)","margin-top":"-250px"}},G={class:"mt-10"},K={class:"space-y-5"},W={class:"text-sm leading-none"},X={class:"text-xs text-gray-500 leading-none"},Z={components:{QrcodeStream:()=>O(()=>import("./vue-qrcode-reader.C_Plo8ti.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(S=>S.QrcodeStream)}},re=Object.assign(Z,{__name:"income",setup(S){const u=n(!1),w=n(""),C=()=>{if(!l.value){alert("입금액을 입력해주세요");return}u.value=!0,w.value=""},E=t=>{var s;const e=(s=t[0])==null?void 0:s.rawValue;e&&(k.value.includes(e)?N():alert("인증오류"),u.value=!1)},I=t=>{w.value="카메라 접근 실패",console.error(t),u.value=!1},g=n([]),_=n(1),x=n(!1),d=n(!0),P=n([]),V=n([]),k=n([]),z=n(null),l=n(null),y=async t=>{if(x.value||!d.value)return;const e=sessionStorage.getItem("idnt_code");if(e){x.value=!0;try{const s=await v("bank.php",{mode:"history",idnt_code:e,page:t||_.value,rows:10});s.result==="SUCCESS"&&Array.isArray(s.data)?s.data.length===0?d.value=!1:(g.value.push(...s.data),_.value++):d.value=!1}catch(s){console.error("포인트 조회 실패:",s),d.value=!1}finally{x.value=!1}}},U=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentList",teacher:t});e.result==="SUCCESS"&&(c.value=await h(),P.value=e.data.map(a=>({label:a.student_name,value:a.idnt_code})))},L=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentRoleList",teacher:t});e.result==="SUCCESS"&&(V.value=e.data.map(a=>a.student_name).join(", "),k.value=e.data.map(a=>a.idnt_code))};B(async()=>{y(),U(),L(),window.addEventListener("scroll",D);const t=await h();c.value=t,console.log("내 포인트:",t)});const D=()=>{const t=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;t>=e&&y()},c=n(0),N=async()=>{if(!l.value){alert("입금액을 입력해주세요");return}const t=await v("bank.php",{mode:"income",idnt_code:sessionStorage.getItem("idnt_code"),point:parseInt(l.value)});t.result==="SUCCESS"?(alert("입금 완료"),_.value=1,g.value=[],d.value=!0,await y(1),l.value=null,z.value=null,c.value=await h()):alert(t.message||"입금에 실패했습니다.")};return(t,e)=>{const s=F,a=H;return f(),p("div",null,[e[8]||(e[8]=o("h2",{class:"mb-3 font-bold"},"입금하기",-1)),o("div",null,[o("div",M,[e[2]||(e[2]=o("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[o("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),o("h2",T," 나의 잔액 "+i(c.value),1)]),e[5]||(e[5]=o("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[m(" 입금을 하기 위해선 "),o("span",{style:{"font-weight":"bold",color:"red"}},"은행원의 승인"),m("이 필요합니다. "),o("br"),m(" 은행원 친구와 함께 오세요. ")],-1)),o("div",Y,[b(s,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),b(a,{label:"입금하기",size:"lg",color:"black",onClick:e[1]||(e[1]=r=>C())})]),u.value?(f(),p("div",$,[e[4]||(e[4]=o("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),o("div",q,[m(i(l.value)+" ",1),e[3]||(e[3]=o("span",{style:{"font-size":"16px"}},"돌맹이 입금!",-1))]),b(A(J),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:E,onError:I})])):R("",!0)]),o("div",G,[e[7]||(e[7]=o("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),o("div",K,[(f(!0),p(Q,null,j(g.value,r=>(f(),p("div",{key:r.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[o("span",W,i(r.description)+" ("+i(r.point_type==="save"?"+":"-")+i(r.point.toLocaleString())+"P) ",1),e[6]||(e[6]=o("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),o("span",X,i(r.c_datetime),1)]))),128))])])])}}});export{re as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.C_Plo8ti.js","./entry.C9akT-V3.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
