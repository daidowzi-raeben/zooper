import{_ as O,r as n,o as R,c as p,g as o,e as B,t as i,z as y,f as b,E as Q,F as A,D as j,b as m}from"./entry.Bwxkbzgs.js";import{_ as F}from"./Input.BA-jlC0Z.js";import{_ as H}from"./Button.ydheakDo.js";import{a as S,b as v}from"./api.CikITYnx.js";import{QrcodeStream as J}from"./vue-qrcode-reader.UsnQpBCu.js";import"./Icon.Cm0s3lbA.js";const M={class:"mb-6 flex items-center gap-3"},T={class:"uppercase text-xs font-semibold text-gray-400"},Y={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},$={class:"flex items-center gap-3 mt-6"},q={key:0},G={class:"mt-10"},K={class:"space-y-5"},W={class:"text-sm leading-none"},X={class:"text-xs text-gray-500 leading-none"},Z={components:{QrcodeStream:()=>O(()=>import("./vue-qrcode-reader.UsnQpBCu.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(h=>h.QrcodeStream)}},re=Object.assign(Z,{__name:"income",setup(h){const u=n(!1),w=n(""),E=()=>{if(!l.value){alert("입금액을 입력해주세요");return}u.value=!0,w.value=""},I=t=>{var s;const e=(s=t[0])==null?void 0:s.rawValue;e&&(C.value.includes(e)?z():alert("인증오류"),u.value=!1)},P=t=>{w.value="카메라 접근 실패",console.error(t),u.value=!1},f=n([]),g=n(1),_=n(!1),d=n(!0),V=n([]),k=n([]),C=n([]),U=n(null),l=n(null),x=async t=>{if(_.value||!d.value)return;const e=sessionStorage.getItem("idnt_code");if(e){_.value=!0;try{const s=await v("bank.php",{mode:"history",idnt_code:e,page:t||g.value,rows:10});s.result==="SUCCESS"&&Array.isArray(s.data)?s.data.length===0?d.value=!1:(f.value.push(...s.data),g.value++):d.value=!1}catch(s){console.error("포인트 조회 실패:",s),d.value=!1}finally{_.value=!1}}},L=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentList",teacher:t});e.result==="SUCCESS"&&(c.value=await S(),V.value=e.data.map(a=>({label:a.student_name,value:a.idnt_code})))},D=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentRoleList",teacher:t});e.result==="SUCCESS"&&(k.value=e.data.map(a=>a.student_name).join(", "),C.value=e.data.map(a=>a.idnt_code))};R(async()=>{x(),L(),D(),window.addEventListener("scroll",N);const t=await S();c.value=t,console.log("내 포인트:",t)});const N=()=>{const t=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;t>=e&&x()},c=n(0),z=async()=>{if(!l.value){alert("입금액을 입력해주세요");return}const t=await v("bank.php",{mode:"income",idnt_code:sessionStorage.getItem("idnt_code"),point:parseInt(l.value)});t.result==="SUCCESS"?(alert("입금 완료"),g.value=1,f.value=[],d.value=!0,await x(1),l.value=null,U.value=null,c.value=await S()):alert(t.message||"입금에 실패했습니다.")};return(t,e)=>{const s=F,a=H;return m(),p("div",null,[e[10]||(e[10]=o("h2",{class:"mb-3 font-bold"},"입금하기",-1)),o("div",null,[o("div",M,[e[2]||(e[2]=o("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[o("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),o("h2",T," 나의 잔액 "+i(c.value),1)]),o("p",Y,[e[3]||(e[3]=y(" 입금 할 금액은 ")),o("strong",null,i(k.value),1),e[4]||(e[4]=y(" 친구 중 1명에게 전달하세요.")),e[5]||(e[5]=o("br",null,null,-1)),e[6]||(e[6]=y(" 전달받은 친구가 마지막으로 QR코드 승인을 해야 합니다. "))]),o("div",$,[b(s,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),b(a,{label:"입금하기",size:"lg",color:"black",onClick:e[1]||(e[1]=r=>E())})]),u.value?(m(),p("div",q,[e[7]||(e[7]=o("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),b(Q(J),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:I,onError:P})])):B("",!0)]),o("div",G,[e[9]||(e[9]=o("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),o("div",K,[(m(!0),p(A,null,j(f.value,r=>(m(),p("div",{key:r.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[o("span",W,i(r.description)+" ("+i(r.point_type==="save"?"+":"-")+i(r.point.toLocaleString())+"P) ",1),e[8]||(e[8]=o("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),o("span",X,i(r.c_datetime),1)]))),128))])])])}}});export{re as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.UsnQpBCu.js","./entry.Bwxkbzgs.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
