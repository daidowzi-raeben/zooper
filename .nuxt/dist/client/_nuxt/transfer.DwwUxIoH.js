import{j as x,d as ee,c as v,b as m,g as d,e as F,F as L,D as q,t as h,L as te,n as k,K as G,I as ae,M as le,N as Q,O as g,P as ne,Q as O,J as P,U as oe,V as E,f as w,_ as ie,r as f,o as re,E as se}from"./entry.DomUSECl.js";import{_ as J}from"./Icon.BpoDwBXk.js";import{u as ue,_ as de}from"./Input.CdDI15fg.js";import{u as ce,_ as ge}from"./Button.Bk3_iQLo.js";import{a as T,b as W}from"./api.PGh-ys9G.js";import{QrcodeStream as ve}from"./vue-qrcode-reader.CAiHTuDm.js";const b=ae(P.ui.strategy,P.ui.select,oe),me=ee({components:{UIcon:J},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>b.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>b.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(e){return Object.keys(b.size).includes(e)}},color:{type:String,default:()=>b.default.color,validator(e){return[...P.ui.colors,...Object.keys(b.color)].includes(e)}},variant:{type:String,default:()=>b.default.variant,validator(e){return[...Object.keys(b.variant),...Object.values(b.color).flatMap(u=>Object.keys(u))].includes(e)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:u,slots:S}){const{ui:a,attrs:U}=le("select",Q(e,"ui"),b,Q(e,"class")),{size:B,rounded:y}=ce({ui:a,props:e}),{emitFormChange:n,inputId:p,color:o,size:A,name:I}=ue(e,b),r=g(()=>B.value||A.value),$=l=>{u("update:modelValue",l.target.value)},D=l=>{n(),u("change",l)},M=l=>E(l,e.valueAttribute,E(l,e.optionAttribute)),C=l=>E(l,e.optionAttribute,E(l,e.valueAttribute)),N=l=>["string","number","boolean"].includes(typeof l)?{[e.valueAttribute]:l,[e.optionAttribute]:l}:{...l,[e.valueAttribute]:M(l),[e.optionAttribute]:C(l)},i=g(()=>e.options.map(l=>N(l))),t=g(()=>e.placeholder?[{[e.valueAttribute]:"",[e.optionAttribute]:e.placeholder,disabled:!0},...i.value]:i.value),s=g(()=>{const l=N(e.modelValue),V=t.value.find(j=>j[e.valueAttribute]===l[e.valueAttribute]);return V?V[e.valueAttribute]:""}),_=g(()=>{var V,j;const l=((j=(V=a.value.color)==null?void 0:V[o.value])==null?void 0:j[e.variant])||a.value.variant[e.variant];return ne(O(a.value.base,a.value.form,y.value,a.value.size[r.value],e.padded?a.value.padding[r.value]:"p-0",l==null?void 0:l.replaceAll("{color}",o.value),(z.value||S.leading)&&a.value.leading.padding[r.value],(c.value||S.trailing)&&a.value.trailing.padding[r.value]),e.selectClass)}),z=g(()=>e.icon&&e.leading||e.icon&&!e.trailing||e.loading&&!e.trailing||e.leadingIcon),c=g(()=>e.icon&&e.trailing||e.loading&&e.trailing||e.trailingIcon),H=g(()=>e.loading?e.loadingIcon:e.leadingIcon||e.icon),R=g(()=>e.loading&&!z.value?e.loadingIcon:e.trailingIcon||e.icon),K=g(()=>O(a.value.icon.leading.wrapper,a.value.icon.leading.pointer,a.value.icon.leading.padding[r.value])),Y=g(()=>O(a.value.icon.base,o.value&&P.ui.colors.includes(o.value)&&a.value.icon.color.replaceAll("{color}",o.value),a.value.icon.size[r.value],e.loading&&a.value.icon.loading)),X=g(()=>O(a.value.icon.trailing.wrapper,a.value.icon.trailing.pointer,a.value.icon.trailing.padding[r.value])),Z=g(()=>O(a.value.icon.base,o.value&&P.ui.colors.includes(o.value)&&a.value.icon.color.replaceAll("{color}",o.value),a.value.icon.size[r.value],e.loading&&!z.value&&a.value.icon.loading));return{ui:a,attrs:U,name:I,inputId:p,normalizedOptionsWithPlaceholder:t,normalizedValue:s,isLeading:z,isTrailing:c,selectClass:_,leadingIconName:H,leadingIconClass:Y,leadingWrapperIconClass:K,trailingIconName:R,trailingIconClass:Z,trailingWrapperIconClass:X,onInput:$,onChange:D}}}),fe=["id","name","value","required","disabled"],be=["value","label"],pe=["value","selected","disabled","textContent"],ye=["value","selected","disabled","textContent"];function Ie(e,u,S,a,U,B){const y=J;return m(),v("div",{class:k(e.ui.wrapper)},[d("select",te({id:e.inputId,name:e.name,value:e.modelValue,required:e.required,disabled:e.disabled||e.loading,class:e.selectClass},e.attrs,{onInput:u[0]||(u[0]=(...n)=>e.onInput&&e.onInput(...n)),onChange:u[1]||(u[1]=(...n)=>e.onChange&&e.onChange(...n))}),[(m(!0),v(L,null,q(e.normalizedOptionsWithPlaceholder,(n,p)=>(m(),v(L,null,[n.children?(m(),v("optgroup",{key:`${n[e.valueAttribute]}-optgroup-${p}`,value:n[e.valueAttribute],label:n[e.optionAttribute]},[(m(!0),v(L,null,q(n.children,(o,A)=>(m(),v("option",{key:`${o[e.valueAttribute]}-${p}-${A}`,value:o[e.valueAttribute],selected:o[e.valueAttribute]===e.normalizedValue,disabled:o.disabled,textContent:h(o[e.optionAttribute])},null,8,pe))),128))],8,be)):(m(),v("option",{key:`${n[e.valueAttribute]}-${p}`,value:n[e.valueAttribute],selected:n[e.valueAttribute]===e.normalizedValue,disabled:n.disabled,textContent:h(n[e.optionAttribute])},null,8,ye))],64))),256))],16,fe),e.isLeading&&e.leadingIconName||e.$slots.leading?(m(),v("span",{key:0,class:k(e.leadingWrapperIconClass)},[G(e.$slots,"leading",{disabled:e.disabled,loading:e.loading},()=>[w(y,{name:e.leadingIconName,class:k(e.leadingIconClass)},null,8,["name","class"])])],2)):F("",!0),e.isTrailing&&e.trailingIconName||e.$slots.trailing?(m(),v("span",{key:1,class:k(e.trailingWrapperIconClass)},[G(e.$slots,"trailing",{disabled:e.disabled,loading:e.loading},()=>[w(y,{name:e.trailingIconName,class:k(e.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])])],2)):F("",!0)],2)}const he=x(me,[["render",Ie]]),Se={class:"mb-6 flex items-center gap-3"},Ae={class:"uppercase text-xs font-semibold text-gray-400"},Ce={class:"flex items-center gap-3 mt-6"},_e={key:0},ze={class:"mt-10"},we={class:"space-y-5"},$e={class:"text-sm leading-none"},Ve={class:"text-xs text-gray-500 leading-none"},ke={components:{QrcodeStream:()=>ie(()=>import("./vue-qrcode-reader.CAiHTuDm.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.QrcodeStream)}},Ee=Object.assign(ke,{__name:"transfer",setup(e){const u=f(!1),S=f(""),a=()=>{if(!r.value){alert("출금액을 입력해주세요");return}if(!I.value){alert("출금할 학생을 선택해주세요");return}if(r.value>C.value){alert("잔액이 부족합니다.");return}u.value=!0,S.value=""},U=i=>{var s;const t=(s=i[0])==null?void 0:s.rawValue;if(t===sessionStorage.getItem("idnt_code"))N();else return u.value=!1,alert("인증오류");t&&(u.value=!1)},B=i=>{S.value="카메라 접근 실패",console.error(i),u.value=!1},y=f([]),n=f(1),p=f(!1),o=f(!0),A=f([]),I=f(null),r=f(null),$=async i=>{if(p.value||!o.value)return;const t=sessionStorage.getItem("idnt_code");if(t){p.value=!0;try{const s=await W("bank.php",{mode:"history",idnt_code:t,page:i||n.value,rows:10});s.result==="SUCCESS"&&Array.isArray(s.data)?s.data.length===0?o.value=!1:(y.value.push(...s.data),n.value++):o.value=!1}catch(s){console.error("포인트 조회 실패:",s),o.value=!1}finally{p.value=!1}}},D=async()=>{var s;const i=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!i)return;const t=await W("member.php",{mode:"studentList",teacher:i});t.result==="SUCCESS"&&(C.value=await T(),A.value=t.data.map(_=>({label:_.student_name,value:_.idnt_code})))};re(async()=>{$(),D(),window.addEventListener("scroll",M);const i=await T();C.value=i,console.log("내 포인트:",i)});const M=()=>{const i=window.scrollY+window.innerHeight,t=document.body.offsetHeight-50;i>=t&&$()},C=f(0),N=async()=>{if(!r.value){alert("출금액을 입력해주세요");return}if(!I.value){alert("출금할 학생을 선택해주세요");return}const i=await W("bank.php",{mode:"deposit",from_idnt_code:sessionStorage.getItem("idnt_code"),to_idnt_code:I.value,point:parseInt(r.value)});i.result==="SUCCESS"?(alert("출금 완료"),n.value=1,y.value=[],o.value=!0,await $(1),r.value=null,I.value=null):alert(i.message||"출금에 실패했습니다.")};return(i,t)=>{const s=he,_=de,z=ge;return m(),v("div",null,[d("div",null,[d("div",Se,[t[3]||(t[3]=d("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[d("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),d("h2",Ae," 나의 잔액 "+h(C.value),1)]),t[5]||(t[5]=d("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 입금 할 친구를 선택하고 금액을 입력하세요 ",-1)),d("div",Ce,[w(s,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=c=>I.value=c),options:A.value,placeholder:"학생 선택",class:"w-40",size:"lg"},null,8,["modelValue","options"]),w(_,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=c=>r.value=c),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),w(z,{label:"이체하기",size:"lg",color:"black",onClick:t[2]||(t[2]=c=>a())})]),u.value?(m(),v("div",_e,[t[4]||(t[4]=d("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),w(se(ve),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:U,onError:B})])):F("",!0)]),d("div",ze,[t[7]||(t[7]=d("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),d("div",we,[(m(!0),v(L,null,q(y.value,c=>(m(),v("div",{key:c.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[d("span",$e,h(c.description)+" ("+h(c.point_type==="save"?"+":"-")+h(c.point.toLocaleString())+"P) ",1),t[6]||(t[6]=d("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),d("span",Ve,h(c.c_datetime),1)]))),128))])])])}}});export{Ee as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.CAiHTuDm.js","./entry.DomUSECl.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
