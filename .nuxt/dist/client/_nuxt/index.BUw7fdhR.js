import{_ as D,r as l,o as N,c as f,g as t,z as k,f as p,t as i,e as j,E as B,F as O,D as $,b as v}from"./entry.pg_3mPfN.js";import{_ as A}from"./Button.BI8xpJkd.js";import{_ as Q}from"./Select.Ol3prK82.js";import{_ as F}from"./Input.Xf6zZ63D.js";import{a as V,b as y}from"./api.CikITYnx.js";import{QrcodeStream as H}from"./vue-qrcode-reader.CDMT3P41.js";import"./Icon.BRsapoGP.js";const M={class:"space-y-4"},T={class:"flex justify-between items-center"},J={class:"col-span-2 rounded-2xl shadow-md p-4 bg-gradient-to-r from-green-400 to-blue-500 text-white flex justify-between items-center"},R={class:"flex flex-col justify-center"},Y={class:"text-2xl font-bold"},q={class:"mb-6 flex items-center gap-3"},G={class:"uppercase text-xs font-semibold text-gray-400"},K={class:"flex items-center gap-3 mt-6"},W={key:0},X={class:"mt-10"},Z={class:"space-y-5"},ee={class:"text-sm leading-none"},te={class:"text-xs text-gray-500 leading-none"},oe={components:{QrcodeStream:()=>D(()=>import("./vue-qrcode-reader.CDMT3P41.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(h=>h.QrcodeStream)}},ue=Object.assign(oe,{__name:"index",setup(h){const d=l(!1),w=l(""),C=()=>{if(!a.value){alert("출금액을 입력해주세요");return}if(!r.value){alert("출금할 학생을 선택해주세요");return}if(a.value>c.value){alert("잔액이 부족합니다.");return}d.value=!0,w.value=""},E=o=>{var s;const e=(s=o[0])==null?void 0:s.rawValue;if(e===sessionStorage.getItem("t_idnt_code"))L();else return d.value=!1,alert("인증오류");e&&(d.value=!1)},P=o=>{w.value="카메라 접근 실패",console.error(o),d.value=!1},g=l([]),x=l(1),_=l(!1),u=l(!0),S=l([]),r=l(null),a=l(null),b=async o=>{if(_.value||!u.value)return;const e=sessionStorage.getItem("t_idnt_code");if(e){_.value=!0;try{const s=await y("bank.php",{mode:"history",idnt_code:e,page:o||x.value,rows:10});s.result==="SUCCESS"&&Array.isArray(s.data)?s.data.length===0?u.value=!1:(g.value.push(...s.data),x.value++):u.value=!1}catch(s){console.error("포인트 조회 실패:",s),u.value=!1}finally{_.value=!1}}},U=async()=>{var s;const o=(s=JSON.parse(sessionStorage.getItem("teacher")))==null?void 0:s.idx;if(!o)return;const e=await y("member.php",{mode:"studentList",teacher:o});e.result==="SUCCESS"&&(c.value=await V(),S.value=e.data.map(m=>({label:m.student_name,value:m.idnt_code})))};N(async()=>{b(),U(),window.addEventListener("scroll",I);const o=await V();c.value=o,console.log("내 포인트:",o)});const I=()=>{const o=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;o>=e&&b()},c=l(0),L=async()=>{if(!a.value){alert("출금액을 입력해주세요");return}if(!r.value){alert("출금할 학생을 선택해주세요");return}const o=await y("bank.php",{mode:"deposit",from_idnt_code:sessionStorage.getItem("t_idnt_code"),to_idnt_code:r.value,point:parseInt(a.value)});o.result==="SUCCESS"?(alert("출금 완료"),x.value=1,g.value=[],u.value=!0,await b(1),a.value=null,r.value=null):alert(o.message||"출금에 실패했습니다.")};return(o,e)=>{const s=A,m=Q,z=F;return v(),f("div",null,[t("div",M,[t("div",T,[e[6]||(e[6]=t("p",{class:"text-lg font-semibold text-gray-700"},"선생님, 환영합니다 👋",-1)),t("button",{class:"flex items-center gap-2 bg-white text-red-500 border border-red-300 px-3 py-1 rounded-full shadow-sm hover:bg-red-50 transition",onClick:e[0]||(e[0]=(...n)=>o.logout&&o.logout(...n))},e[5]||(e[5]=[t("span",{class:"i-heroicons-arrow-right-on-rectangle w-4 h-4"},null,-1),k(" 로그아웃 ")]))]),t("div",J,[t("div",R,[e[8]||(e[8]=t("p",{class:"text-sm opacity-80"},"국고 잔액",-1)),t("p",Y,[t("span",null,[k(" 💰 "+i(Number(c.value||0).toLocaleString())+" ",1),e[7]||(e[7]=t("span",{class:"text-sm font-normal align-middle"},"돌멩이",-1))])])]),p(s,{label:"이체하기",color:"white",class:"text-blue-800 bg-white bg-opacity-90 hover:bg-opacity-100",onClick:e[1]||(e[1]=n=>o.$router.push("/transfer"))})])]),t("div",null,[t("div",q,[e[9]||(e[9]=t("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[t("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),t("h2",G," 나의 잔액 "+i(c.value),1)]),e[11]||(e[11]=t("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 입금 할 친구를 선택하고 금액을 입력하세요 ",-1)),t("div",K,[p(m,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value=n),options:S.value,placeholder:"학생 선택",class:"w-40",size:"lg"},null,8,["modelValue","options"]),p(z,{modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value=n),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),p(s,{label:"이체하기",size:"lg",color:"black",onClick:e[4]||(e[4]=n=>C())})]),d.value?(v(),f("div",W,[e[10]||(e[10]=t("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),p(B(H),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:E,onError:P})])):j("",!0)]),t("div",X,[e[13]||(e[13]=t("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),t("div",Z,[(v(!0),f(O,null,$(g.value,n=>(v(),f("div",{key:n.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[t("span",ee,i(n.description)+" ("+i(n.point_type==="save"?"+":"-")+i(n.point.toLocaleString())+"P) ",1),e[12]||(e[12]=t("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),t("span",te,i(n.c_datetime),1)]))),128))])])])}}});export{ue as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.CDMT3P41.js","./entry.pg_3mPfN.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
