import{_ as O,r as a,o as R,c as p,g as o,e as z,t as c,f as y,E as B,F as Q,D as A,b as m}from"./entry.F1JkwR54.js";import{_ as j}from"./Input.BjymYylk.js";import{_ as F}from"./Button.DrUXzk9G.js";import{a as h,b as v}from"./api.xjxtr2Ie.js";import{QrcodeStream as H}from"./vue-qrcode-reader.cXsImeV7.js";import"./Icon.BVbi-A3u.js";const J={class:"mb-6 flex items-center gap-3"},M={class:"uppercase text-xs font-semibold text-gray-400"},T={class:"flex items-center gap-3 mt-6"},Y={key:0},$={class:"mt-10"},q={class:"space-y-5"},G={class:"text-sm leading-none"},K={class:"text-xs text-gray-500 leading-none"},W={components:{QrcodeStream:()=>O(()=>import("./vue-qrcode-reader.cXsImeV7.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(S=>S.QrcodeStream)}},ae=Object.assign(W,{__name:"penalty",setup(S){const i=a(!1),b=a(""),w=()=>{if(!l.value){alert("입금액을 입력해주세요");return}if(l.value>u.value){alert("잔액이 부족합니다.");return}i.value=!0,b.value=""},k=t=>{var s;const e=(s=t[0])==null?void 0:s.rawValue;if(e===sessionStorage.getItem("idnt_code"))N();else return i.value=!1,alert("인증오류");e&&(i.value=!1)},C=t=>{b.value="카메라 접근 실패",console.error(t),i.value=!1},f=a([]),g=a(1),_=a(!1),d=a(!0),E=a([]),I=a([]),P=a([]),U=a(null),l=a(null),x=async t=>{if(_.value||!d.value)return;const e=sessionStorage.getItem("idnt_code");if(e){_.value=!0;try{const s=await v("bank.php",{mode:"history",idnt_code:e,page:t||g.value,rows:10});s.result==="SUCCESS"&&Array.isArray(s.data)?s.data.length===0?d.value=!1:(f.value.push(...s.data),g.value++):d.value=!1}catch(s){console.error("포인트 조회 실패:",s),d.value=!1}finally{_.value=!1}}},V=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentList",teacher:t});e.result==="SUCCESS"&&(u.value=await h(),E.value=e.data.map(n=>({label:n.student_name,value:n.idnt_code})))},L=async()=>{var s;const t=(s=JSON.parse(sessionStorage.getItem("student")))==null?void 0:s.teacher;if(!t)return;const e=await v("member.php",{mode:"studentRoleList",teacher:t});e.result==="SUCCESS"&&(I.value=e.data.map(n=>n.student_name).join(", "),P.value=e.data.map(n=>n.idnt_code))};R(async()=>{x(),V(),L(),window.addEventListener("scroll",D);const t=await h();u.value=t,console.log("내 포인트:",t)});const D=()=>{const t=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;t>=e&&x()},u=a(0),N=async()=>{if(!l.value){alert("입금액을 입력해주세요");return}const t=await v("bank.php",{mode:"penalty",idnt_code:sessionStorage.getItem("idnt_code"),point:parseInt(l.value)});t.result==="SUCCESS"?(alert("벌금 납부 완료"),g.value=1,f.value=[],d.value=!0,await x(1),l.value=null,U.value=null,u.value=await h()):alert(t.message||"입금에 실패했습니다.")};return(t,e)=>{const s=j,n=F;return m(),p("div",null,[e[7]||(e[7]=o("h2",{class:"mb-3 font-bold"},"벌금 납부 하기",-1)),o("div",null,[o("div",J,[e[2]||(e[2]=o("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[o("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),o("h2",M," 나의 잔액 "+c(u.value),1)]),e[4]||(e[4]=o("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 납부할 벌금을 입력 후 QR코드로 인증 해 주세요 ",-1)),o("div",T,[y(s,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),y(n,{label:"납부하기",size:"lg",color:"black",onClick:e[1]||(e[1]=r=>w())})]),i.value?(m(),p("div",Y,[e[3]||(e[3]=o("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),y(B(H),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:k,onError:C})])):z("",!0)]),o("div",$,[e[6]||(e[6]=o("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),o("div",q,[(m(!0),p(Q,null,A(f.value,r=>(m(),p("div",{key:r.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[o("span",G,c(r.description)+" ("+c(r.point_type==="save"?"+":"-")+c(r.point.toLocaleString())+" 돌멩이) ",1),e[5]||(e[5]=o("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),o("span",K,c(r.c_datetime),1)]))),128))])])])}}});export{ae as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.cXsImeV7.js","./entry.F1JkwR54.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
