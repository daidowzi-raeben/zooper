import{_ as L,r as n,o as z,c as m,g as s,e as B,t as d,f as v,E as N,F as O,D as A,b as f}from"./entry.DbU2-sp-.js";import{_ as Q}from"./Select.Cvje_Wiw.js";import{_ as F}from"./Input.BGcS6mx6.js";import{_ as H}from"./Button.BEBFRQyV.js";import{a as k,b as h}from"./api.xjxtr2Ie.js";import{QrcodeStream as M}from"./vue-qrcode-reader.B1Pr8U39.js";import"./Icon.PvKdhqY2.js";const $={class:"mb-6 flex items-center gap-3"},j={class:"uppercase text-xs font-semibold text-gray-400"},J={class:"flex items-center gap-3 mt-6"},R={key:0},T={class:"mt-10"},Y={class:"space-y-5"},q={class:"text-sm leading-none"},G={class:"text-xs text-gray-500 leading-none"},K={components:{QrcodeStream:()=>L(()=>import("./vue-qrcode-reader.B1Pr8U39.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(b=>b.QrcodeStream)}},ae=Object.assign(K,{__name:"transfer",setup(b){const i=n(!1),S=n(""),V=()=>{if(!r.value){alert("출금액을 입력해주세요");return}if(!l.value){alert("출금할 학생을 선택해주세요");return}if(r.value>c.value){alert("잔액이 부족합니다.");return}i.value=!0,S.value=""},E=t=>{var o;const e=(o=t[0])==null?void 0:o.rawValue;if(e===sessionStorage.getItem("idnt_code"))P();else return i.value=!1,alert("인증오류");e&&(i.value=!1)},U=t=>{S.value="카메라 접근 실패",console.error(t),i.value=!1},_=n([]),g=n(1),x=n(!1),u=n(!0),w=n([]),l=n(null),r=n(null),y=async t=>{if(x.value||!u.value)return;const e=sessionStorage.getItem("idnt_code");if(e){x.value=!0;try{const o=await h("bank.php",{mode:"history",idnt_code:e,page:t||g.value,rows:10});o.result==="SUCCESS"&&Array.isArray(o.data)?o.data.length===0?u.value=!1:(_.value.push(...o.data),g.value++):u.value=!1}catch(o){console.error("포인트 조회 실패:",o),u.value=!1}finally{x.value=!1}}},C=async()=>{var o;const t=(o=JSON.parse(sessionStorage.getItem("student")))==null?void 0:o.teacher;if(!t)return;const e=await h("member.php",{mode:"studentList",teacher:t});e.result==="SUCCESS"&&(c.value=await k(),w.value=e.data.map(p=>({label:p.student_name,value:p.idnt_code})))};z(async()=>{y(),C(),window.addEventListener("scroll",I);const t=await k();c.value=t,console.log("내 포인트:",t)});const I=()=>{const t=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;t>=e&&y()},c=n(0),P=async()=>{if(!r.value){alert("출금액을 입력해주세요");return}if(!l.value){alert("출금할 학생을 선택해주세요");return}const t=await h("bank.php",{mode:"deposit",from_idnt_code:sessionStorage.getItem("idnt_code"),to_idnt_code:l.value,point:parseInt(r.value)});t.result==="SUCCESS"?(alert("출금 완료"),g.value=1,_.value=[],u.value=!0,await y(1),r.value=null,l.value=null):alert(t.message||"출금에 실패했습니다.")};return(t,e)=>{const o=Q,p=F,D=H;return f(),m("div",null,[s("div",null,[s("div",$,[e[3]||(e[3]=s("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[s("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),s("h2",j," 나의 잔액 "+d(c.value),1)]),e[5]||(e[5]=s("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"}," 입금 할 친구를 선택하고 금액을 입력하세요 ",-1)),s("div",J,[v(o,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a),options:w.value,placeholder:"학생 선택",class:"w-40",size:"lg"},null,8,["modelValue","options"]),v(p,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=a=>r.value=a),placeholder:"입금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),v(D,{label:"이체하기",size:"lg",color:"black",onClick:e[2]||(e[2]=a=>V())})]),i.value?(f(),m("div",R,[e[4]||(e[4]=s("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),v(N(M),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:E,onError:U})])):B("",!0)]),s("div",T,[e[7]||(e[7]=s("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),s("div",Y,[(f(!0),m(O,null,A(_.value,a=>(f(),m("div",{key:a.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[s("span",q,d(a.description)+" ("+d(a.point_type==="save"?"+":"-")+d(a.point.toLocaleString())+" 돌멩이) ",1),e[6]||(e[6]=s("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),s("span",G,d(a.c_datetime),1)]))),128))])])])}}});export{ae as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.B1Pr8U39.js","./entry.DbU2-sp-.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
