import{_ as O,r as a,o as B,c as p,g as s,e as R,t as i,z as m,f as b,E as A,F as Q,D as j,b as f}from"./entry.pg_3mPfN.js";import{_ as F}from"./Input.Xf6zZ63D.js";import{_ as H}from"./Button.BI8xpJkd.js";import{a as h,b as v}from"./api.CikITYnx.js";import{QrcodeStream as J}from"./vue-qrcode-reader.CDMT3P41.js";import"./Icon.BRsapoGP.js";const M={class:"mb-6 flex items-center gap-3"},T={class:"uppercase text-xs font-semibold text-gray-400"},Y={class:"flex items-center gap-3 mt-6"},$={key:0},q={style:{"z-index":"100",top:"50%",left:"50%",color:"#fff","font-size":"30px",position:"fixed",transform:"translate(-50%,-50%)","margin-top":"-250px"}},G={class:"mt-10"},K={class:"space-y-5"},W={class:"text-sm leading-none"},X={class:"text-xs text-gray-500 leading-none"},Z={components:{QrcodeStream:()=>O(()=>import("./vue-qrcode-reader.CDMT3P41.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(S=>S.QrcodeStream)}},re=Object.assign(Z,{__name:"expense",setup(S){const c=a(!1),w=a(""),C=()=>{if(!n.value){alert("출금액을 입력해주세요");return}if(n.value>u.value){alert("잔액이 부족합니다.");return}c.value=!0,w.value=""},E=t=>{var o;const e=(o=t[0])==null?void 0:o.rawValue;e&&(k.value.includes(e)?N():alert("인증오류"),c.value=!1)},I=t=>{w.value="카메라 접근 실패",console.error(t),c.value=!1},g=a([]),x=a(1),_=a(!1),d=a(!0),V=a([]),z=a([]),k=a([]),P=a(null),n=a(null),y=async t=>{if(_.value||!d.value)return;const e=sessionStorage.getItem("idnt_code");if(e){_.value=!0;try{const o=await v("bank.php",{mode:"history",idnt_code:e,page:t||x.value,rows:10});o.result==="SUCCESS"&&Array.isArray(o.data)?o.data.length===0?d.value=!1:(g.value.push(...o.data),x.value++):d.value=!1}catch(o){console.error("포인트 조회 실패:",o),d.value=!1}finally{_.value=!1}}},U=async()=>{var o;const t=(o=JSON.parse(sessionStorage.getItem("student")))==null?void 0:o.teacher;if(!t)return;const e=await v("member.php",{mode:"studentList",teacher:t});e.result==="SUCCESS"&&(u.value=await h(),V.value=e.data.map(r=>({label:r.student_name,value:r.idnt_code})))},L=async()=>{var o;const t=(o=JSON.parse(sessionStorage.getItem("student")))==null?void 0:o.teacher;if(!t)return;const e=await v("member.php",{mode:"studentRoleList",teacher:t});e.result==="SUCCESS"&&(z.value=e.data.map(r=>r.student_name).join(", "),k.value=e.data.map(r=>r.idnt_code))};B(async()=>{y(),U(),L(),window.addEventListener("scroll",D);const t=await h();u.value=t,console.log("내 포인트:",t)});const D=()=>{const t=window.scrollY+window.innerHeight,e=document.body.offsetHeight-50;t>=e&&y()},u=a(0),N=async()=>{if(!n.value){alert("출금액을 입력해주세요");return}const t=await v("bank.php",{mode:"expense",idnt_code:sessionStorage.getItem("idnt_code"),point:parseInt(n.value)});t.result==="SUCCESS"?(alert("출금 완료"),x.value=1,g.value=[],d.value=!0,await y(1),n.value=null,P.value=null,u.value=await h()):alert(t.message||"출금에 실패했습니다.")};return(t,e)=>{const o=F,r=H;return f(),p("div",null,[e[8]||(e[8]=s("h2",{class:"mb-3 font-bold"},"출금하기",-1)),s("div",null,[s("div",M,[e[2]||(e[2]=s("div",{class:"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10"},[s("div",{class:"h-1.5 w-1.5 rounded-full bg-current"})],-1)),s("h2",T," 나의 잔액 "+i(u.value),1)]),e[5]||(e[5]=s("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},[m(" 출금을 하기 위해선 "),s("span",{style:{"font-weight":"bold",color:"red"}},"은행원의 승인"),m("이 필요합니다. "),s("br"),m(" 은행원 친구와 함께 오세요. ")],-1)),s("div",Y,[b(o,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),placeholder:"출금액을 입력하세요",icon:"i-heroicons-currency-dollar",class:"flex-1 text-right","input-class":"text-right",type:"tel",size:"lg"},null,8,["modelValue"]),b(r,{label:"출금하기",size:"lg",color:"black",onClick:e[1]||(e[1]=l=>C())})]),c.value?(f(),p("div",$,[e[4]||(e[4]=s("div",{style:{"background-color":"#000",position:"fixed",top:"0",left:"0",width:"100%",height:"100%","z-index":"99",opacity:"0.6"}},null,-1)),s("div",q,[m(i(n.value)+" ",1),e[3]||(e[3]=s("span",{style:{"font-size":"16px"}},"돌멩이 출금!",-1))]),b(A(J),{style:{top:"50%",left:"50%","z-index":"99",position:"fixed",transform:"translate(-50%,-50%)","max-width":"400px","max-height":"400px"},onDetect:E,onError:I})])):R("",!0)]),s("div",G,[e[7]||(e[7]=s("h2",{class:"uppercase text-xs font-semibold text-gray-400 mb-4"},"최근 입출금내역",-1)),s("div",K,[(f(!0),p(Q,null,j(g.value,l=>(f(),p("div",{key:l.idx,class:"flex items-center gap-4 dark:hover:text-gray-300 group"},[s("span",W,i(l.description)+" ("+i(l.point_type==="save"?"+":"-")+i(l.point.toLocaleString())+" 돌멩이) ",1),e[6]||(e[6]=s("div",{class:"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5"},null,-1)),s("span",X,i(l.c_datetime),1)]))),128))])])])}}});export{re as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./vue-qrcode-reader.CDMT3P41.js","./entry.pg_3mPfN.js","./entry.BxOTx4W7.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
