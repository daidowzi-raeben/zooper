{"version":3,"file":"index-BkAikQy_.js","sources":["../../../../pages/teacher/index.vue"],"sourcesContent":["<script setup>\nimport { onMounted, ref } from 'vue'\nimport { apiPost,apiPoint } from '@/common/api'\n\n//  QR\nimport { QrcodeStream } from 'vue-qrcode-reader'\n\nconst isScanning = ref(false)\nconst error = ref('')\n\nconst startScan = () => {\n\nif (!amountInput.value) {\n    alert('Ï∂úÍ∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî')\n    return\n  }\n  if (!selectedStudent.value) {\n    alert('Ï∂úÍ∏àÌï† ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî')\n    return\n  }\n\n  if(amountInput.value > memberPoint.value) {\n    alert('ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§.')\n    return\n}\n  \n  isScanning.value = true\n  error.value = ''\n}\n\nconst onDetect = (detectedCodes) => {\n  const url = detectedCodes[0]?.rawValue\nif(url === sessionStorage.getItem('t_idnt_code')) {\n  handleDeposit()\n  } else {\n    isScanning.value = false\n      return alert('Ïù∏Ï¶ùÏò§Î•ò')\n    }\n  if (!url) return\n\n  isScanning.value = false\n//   router.push('/sign/' + url)\n}\n\nconst onError = (err) => {\n  error.value = 'Ïπ¥Î©îÎùº Ï†ëÍ∑º Ïã§Ìå®'\n  console.error(err)\n  isScanning.value = false\n}\n\n\n//  QR\nconst points = ref([])\nconst page = ref(1)\nconst isLoading = ref(false)\nconst hasMore = ref(true)\n\nconst studentOptions = ref([])\nconst selectedStudent = ref(null)\nconst amountInput = ref(null)\n\nconst fetchPoints = async (v) => {\n  if (isLoading.value || !hasMore.value) return\n\n  const idnt_code = sessionStorage.getItem('t_idnt_code')\n  if (!idnt_code) return\n\n  isLoading.value = true\n\n  try {\n    const res = await apiPost('bank.php', {\n      mode: 'history',\n      idnt_code,\n      page: v || page.value,\n      rows: 10,\n    })\n\n    if (res.result === 'SUCCESS' && Array.isArray(res.data)) {\n      if (res.data.length === 0) {\n        hasMore.value = false\n      } else {\n        points.value.push(...res.data)\n        page.value++\n      }\n    } else {\n      hasMore.value = false\n    }\n  } catch (error) {\n    console.error('Ìè¨Ïù∏Ìä∏ Ï°∞Ìöå Ïã§Ìå®:', error)\n    hasMore.value = false\n  } finally {\n    isLoading.value = false\n  }\n}\n\nconst fetchStudents = async () => {\n  const teacher = JSON.parse(sessionStorage.getItem('teacher'))?.idx\n  if (!teacher) return\n\n  const res = await apiPost('member.php', {\n    mode: 'studentList',\n    teacher\n  })\n\n  if (res.result === 'SUCCESS') {\n    memberPoint.value = await apiPoint()\n    studentOptions.value = res.data.map(s => ({\n      label: s.student_name,\n      value: s.idnt_code\n    }))\n  }\n}\n\nonMounted(async () => {\n\n  fetchPoints()\n  fetchStudents()\n  window.addEventListener('scroll', handleScroll)\n\n  const point = await apiPoint()\n  memberPoint.value = point\n  console.log('ÎÇ¥ Ìè¨Ïù∏Ìä∏:', point)\n})\n\nconst handleScroll = () => {\n  const scrollPosition = window.scrollY + window.innerHeight\n  const bottomPosition = document.body.offsetHeight - 50\n  if (scrollPosition >= bottomPosition) {\n    fetchPoints()\n  }\n}\n\n\nconst memberPoint = ref(0)\nconst handleDeposit = async () => {\n  if (!amountInput.value) {\n    alert('Ï∂úÍ∏àÏï°ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî')\n    return\n  }\n  if (!selectedStudent.value) {\n    alert('Ï∂úÍ∏àÌï† ÌïôÏÉùÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî')\n    return\n  }\n\n  const res = await apiPost('bank.php', {\n    mode: 'deposit',\n    from_idnt_code: sessionStorage.getItem('t_idnt_code'),\n    to_idnt_code: selectedStudent.value,\n    point: parseInt(amountInput.value)\n  })\n\n  if (res.result === 'SUCCESS') {\n    alert('Ï∂úÍ∏à ÏôÑÎ£å')\n\n    // Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî Î∞è Îã§Ïãú Ï°∞Ìöå\n    page.value = 1\n    points.value = []\n    hasMore.value = true\n    await fetchPoints(1)\n\n    amountInput.value = null\n    selectedStudent.value = null\n  } else {\n    alert(res.message || 'Ï∂úÍ∏àÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.')\n  }\n}\n\n</script>\n\n<template>\n  <div>\n      <div class=\"space-y-4\">\n    <!-- ÌôòÏòÅ Î©îÏãúÏßÄ -->\n    <div class=\"flex justify-between items-center\">\n      <p class=\"text-lg font-semibold text-gray-700\">ÏÑ†ÏÉùÎãò, ÌôòÏòÅÌï©ÎãàÎã§ üëã</p>\n      <button\n        class=\"flex items-center gap-2 bg-white text-red-500 border border-red-300 px-3 py-1 rounded-full shadow-sm hover:bg-red-50 transition\"\n        @click=\"logout\"\n      >\n        <span class=\"i-heroicons-arrow-right-on-rectangle w-4 h-4\" />\n        Î°úÍ∑∏ÏïÑÏõÉ\n      </button>\n    </div>\n        <!-- ÎÇ¥ ÏûîÏï° -->\n    <div class=\"col-span-2 rounded-2xl shadow-md p-4 bg-gradient-to-r from-green-400 to-blue-500 text-white flex justify-between items-center\">\n      <div class=\"flex flex-col justify-center\">\n        <p class=\"text-sm opacity-80\">Íµ≠Í≥† ÏûîÏï°</p>\n        <p class=\"text-2xl font-bold\">\n          <span>\n          üí∞ {{ Number(memberPoint || 0).toLocaleString() }} <span class=\"text-sm font-normal align-middle\">ÎèåÎ©©Ïù¥</span>\n          </span>\n        </p>\n      </div>\n      <UButton\n        label=\"Ïù¥Ï≤¥ÌïòÍ∏∞\"\n        color=\"white\"\n        class=\"text-blue-800 bg-white bg-opacity-90 hover:bg-opacity-100\"\n        @click=\"$router.push('/transfer')\"\n      />\n    </div>\n    </div>\n      <div>\n        <div class=\"mb-6 flex items-center gap-3\">\n        <div\n            class=\"flex-none rounded-full p-1 text-primary-500 bg-primary-500/10\"\n        >\n            <div class=\"h-1.5 w-1.5 rounded-full bg-current\"></div>\n        </div>\n        <h2 class=\"uppercase text-xs font-semibold text-gray-400\">\n            ÎÇòÏùò ÏûîÏï° {{ memberPoint }}\n        </h2>\n        </div>\n        <p class=\"mt-2 text-sm text-gray-600 dark:text-gray-400\">\n        ÏûÖÍ∏à Ìï† ÏπúÍµ¨Î•º ÏÑ†ÌÉùÌïòÍ≥† Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî\n        </p>\n        <div class=\"flex items-center gap-3 mt-6\">\n       <USelect\n          v-model=\"selectedStudent\"\n          :options=\"studentOptions\"\n          placeholder=\"ÌïôÏÉù ÏÑ†ÌÉù\"\n          class=\"w-40\"\n          size=\"lg\"\n        />\n        <UInput\n            v-model=\"amountInput\"\n            placeholder=\"ÏûÖÍ∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî\"\n            icon=\"i-heroicons-currency-dollar\"\n            class=\"flex-1 text-right\"\n            input-class=\"text-right\"\n            type=\"tel\"\n            size=\"lg\"\n        />\n        <UButton label=\"Ïù¥Ï≤¥ÌïòÍ∏∞\" size=\"lg\" color=\"black\" @click=\"startScan()\"/>\n        </div>\n        <div v-if=\"isScanning\">\n            <div style=\"background-color: #000; position: fixed; top:0; left:0; width:100%; height:100%; z-index:99; opacity: 0.6;\"></div>\n             <qrcode-stream\n             style=\"top:50%; left:50%; z-index:99; position: fixed; transform: translate(-50%,-50%); max-width:400px; max-height:400px;\"\n            @detect=\"onDetect\"\n            @error=\"onError\"\n        />\n        </div>\n    </div>\n    <div class=\"mt-10\">\n      <h2 class=\"uppercase text-xs font-semibold text-gray-400 mb-4\">ÏµúÍ∑º ÏûÖÏ∂úÍ∏àÎÇ¥Ïó≠</h2>\n      <div class=\"space-y-5\">\n        <div\n        v-for=\"item in points\"\n        :key=\"item.idx\"\n        class=\"flex items-center gap-4 dark:hover:text-gray-300 group\"\n        >\n        <span class=\"text-sm leading-none\">\n            {{ item.description }} ({{ item.point_type === 'save' ? '+' : '-' }}{{ item.point.toLocaleString() }}P)\n        </span>\n        <div class=\"flex-1 border-b border-dashed border-gray-300 dark:border-gray-800 group-hover:border-gray-700 mt-1.5\"></div>\n        <span class=\"text-xs text-gray-500 leading-none\">\n            {{ item.c_datetime }}\n        </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  components: {\n    QrcodeStream: () => import('vue-qrcode-reader').then(m => m.QrcodeStream)\n  }\n}\n</script>"],"names":["error","$router","_ssrRenderList","_ssrInterpolate"],"mappings":"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"}